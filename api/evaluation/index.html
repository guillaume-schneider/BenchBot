
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for BenchBot">
      
      
        <meta name="author" content="Guillaume Schneider">
      
      
        <link rel="canonical" href="https://guillaume-schneider.github.io/BenchBot/api/evaluation/">
      
      
        <link rel="prev" href="../runner_details/">
      
      
        <link rel="next" href="../tools/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Metrics - BenchBot Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#evaluation-module" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="BenchBot Documentation" class="md-header__button md-logo" aria-label="BenchBot Documentation" data-md-component="logo">
      
  <img src="../../assets/images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BenchBot Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Metrics
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/guillaume-schneider/BenchBot" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    BenchBot
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.md" class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../system_overview/" class="md-tabs__link">
          
  
  
  Architecture

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../FAQ/" class="md-tabs__link">
        
  
  
    
  
  FAQ

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../runner/" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../QUICK_START/" class="md-tabs__link">
          
  
  
  User Guides

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../TROUBLESHOOTING_EXPLORATION/" class="md-tabs__link">
          
  
  
  Troubleshooting

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../CONTRIBUTING/" class="md-tabs__link">
        
  
  
    
  
  Contributing

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../ROADMAP/" class="md-tabs__link">
        
  
  
    
  
  Roadmap

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="BenchBot Documentation" class="md-nav__button md-logo" aria-label="BenchBot Documentation" data-md-component="logo">
      
  <img src="../../assets/images/logo.png" alt="logo">

    </a>
    BenchBot Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/guillaume-schneider/BenchBot" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    BenchBot
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Architecture
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system_overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    System Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../orchestrator_architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Orchestrator Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation_logic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Evaluation Logic
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tools & Infrastructure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../FAQ/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FAQ
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runner/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Orchestrator
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runner_details/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Runner Details
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Metrics
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Metrics
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#evaluation.metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        metrics
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evaluation.metrics.align_est_map_to_gt" class="md-nav__link">
    <span class="md-ellipsis">
      
        align_est_map_to_gt
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation.metrics.compute_accessible_coverage" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_accessible_coverage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation.metrics.compute_coverage" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_coverage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation.metrics.compute_iou" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_iou
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation.metrics.compute_path_length" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_path_length
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation.metrics.compute_ssim" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_ssim
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation.metrics.compute_time_to_coverage" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_time_to_coverage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation.metrics.compute_wall_thickness" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_wall_thickness
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation.metrics.detect_anomalies" class="md-nav__link">
    <span class="md-ellipsis">
      
        detect_anomalies
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation.metrics.get_trajectory" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_trajectory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation.metrics.load_gt_map" class="md-nav__link">
    <span class="md-ellipsis">
      
        load_gt_map
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation.metrics.occupancy_arrays_from_msgs" class="md-nav__link">
    <span class="md-ellipsis">
      
        occupancy_arrays_from_msgs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation.metrics.open_bag_reader" class="md-nav__link">
    <span class="md-ellipsis">
      
        open_bag_reader
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation.metrics.read_messages_by_topic" class="md-nav__link">
    <span class="md-ellipsis">
      
        read_messages_by_topic
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation.metrics.ros_time_to_sec" class="md-nav__link">
    <span class="md-ellipsis">
      
        ros_time_to_sec
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation.metrics.save_map_image" class="md-nav__link">
    <span class="md-ellipsis">
      
        save_map_image
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Utilities
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gui/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GUI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gui_pages/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GUI Pages
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gt_map/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GT Map
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    User Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    User Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../QUICK_START/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m13.13 22.19-1.63-3.83c1.57-.58 3.04-1.36 4.4-2.27zM5.64 12.5l-3.83-1.63 6.1-2.77C7 9.46 6.22 10.93 5.64 12.5M21.61 2.39S16.66.269 11 5.93c-2.19 2.19-3.5 4.6-4.35 6.71-.28.75-.09 1.57.46 2.13l2.13 2.12c.55.56 1.37.74 2.12.46A19.1 19.1 0 0 0 18.07 13c5.66-5.66 3.54-10.61 3.54-10.61m-7.07 7.07c-.78-.78-.78-2.05 0-2.83s2.05-.78 2.83 0c.77.78.78 2.05 0 2.83s-2.05.78-2.83 0m-5.66 7.07-1.41-1.41zM6.24 22l3.64-3.64c-.34-.09-.67-.24-.97-.45L4.83 22zM2 22h1.41l4.77-4.76-1.42-1.41L2 20.59zm0-2.83 4.09-4.08c-.21-.3-.36-.62-.45-.97L2 17.76z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Quick Start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../INSTALLATION/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5 20h14v-2H5m14-9h-4V3H9v6H5l7 7z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Installation Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SETUP_AND_SPECS/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 6h16v10H4m16 2a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H4c-1.11 0-2 .89-2 2v10a2 2 0 0 0 2 2H0v2h24v-2z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Setup & Specs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CONFIG_REFERENCE/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 15.5A3.5 3.5 0 0 1 8.5 12 3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5 3.5 3.5 0 0 1-3.5 3.5m7.43-2.53c.04-.32.07-.64.07-.97s-.03-.66-.07-1l2.11-1.63c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.31-.61-.22l-2.49 1c-.52-.39-1.06-.73-1.69-.98l-.37-2.65A.506.506 0 0 0 14 2h-4c-.25 0-.46.18-.5.42l-.37 2.65c-.63.25-1.17.59-1.69.98l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64L4.57 11c-.04.34-.07.67-.07 1s.03.65.07.97l-2.11 1.66c-.19.15-.25.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1.01c.52.4 1.06.74 1.69.99l.37 2.65c.04.24.25.42.5.42h4c.25 0 .46-.18.5-.42l.37-2.65c.63-.26 1.17-.59 1.69-.99l2.49 1.01c.22.08.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Configuration Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SIMULATORS/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 6h10a6 6 0 0 1 6 6 6 6 0 0 1-6 6c-1.78 0-3.37-.77-4.47-2h-1.06c-1.1 1.23-2.69 2-4.47 2a6 6 0 0 1-6-6 6 6 0 0 1 6-6M6 9v2H4v2h2v2h2v-2h2v-2H8V9zm9.5 3a1.5 1.5 0 0 0-1.5 1.5 1.5 1.5 0 0 0 1.5 1.5 1.5 1.5 0 0 0 1.5-1.5 1.5 1.5 0 0 0-1.5-1.5m3-3a1.5 1.5 0 0 0-1.5 1.5 1.5 1.5 0 0 0 1.5 1.5 1.5 1.5 0 0 0 1.5-1.5A1.5 1.5 0 0 0 18.5 9"/></svg>
  
  <span class="md-ellipsis">
    
  
    Simulators
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../METRICS/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 19v1h18v2H2V2h2v15c3 0 6-2 8.1-5.6 3-5 6.3-7.4 9.9-7.4v2c-2.8 0-5.5 2.1-8.1 6.5C11.3 16.6 7.7 19 4 19"/></svg>
  
  <span class="md-ellipsis">
    
  
    Metrics Explained
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../AUTO_TUNER_GUIDE/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17.5 9a2.5 2.5 0 0 1 0-5 2.5 2.5 0 0 1 0 5m-3.07-.85L2 20.59 3.41 22 15.85 9.57c-.6-.33-1.09-.82-1.42-1.42M13 5l.63-1.37L15 3l-1.37-.63L13 1l-.62 1.37L11 3l1.38.63zm8 0 .63-1.37L23 3l-1.37-.63L21 1l-.62 1.37L19 3l1.38.63zm0 4-.62 1.37L19 11l1.38.63L21 13l.63-1.37L23 11l-1.37-.63z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Auto-Tuner Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Troubleshooting
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Troubleshooting
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../TROUBLESHOOTING_EXPLORATION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Exploration Issues
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../TROUBLESHOOTING_GMAPPING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GMapping Issues
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../HEADLESS_CI/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Headless Mode
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MULTI_SLAM_GUIDE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Multi-SLAM Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CONTRIBUTING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ROADMAP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Roadmap
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#evaluation.metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        metrics
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evaluation.metrics.align_est_map_to_gt" class="md-nav__link">
    <span class="md-ellipsis">
      
        align_est_map_to_gt
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation.metrics.compute_accessible_coverage" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_accessible_coverage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation.metrics.compute_coverage" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_coverage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation.metrics.compute_iou" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_iou
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation.metrics.compute_path_length" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_path_length
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation.metrics.compute_ssim" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_ssim
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation.metrics.compute_time_to_coverage" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_time_to_coverage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation.metrics.compute_wall_thickness" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_wall_thickness
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation.metrics.detect_anomalies" class="md-nav__link">
    <span class="md-ellipsis">
      
        detect_anomalies
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation.metrics.get_trajectory" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_trajectory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation.metrics.load_gt_map" class="md-nav__link">
    <span class="md-ellipsis">
      
        load_gt_map
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation.metrics.occupancy_arrays_from_msgs" class="md-nav__link">
    <span class="md-ellipsis">
      
        occupancy_arrays_from_msgs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation.metrics.open_bag_reader" class="md-nav__link">
    <span class="md-ellipsis">
      
        open_bag_reader
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation.metrics.read_messages_by_topic" class="md-nav__link">
    <span class="md-ellipsis">
      
        read_messages_by_topic
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation.metrics.ros_time_to_sec" class="md-nav__link">
    <span class="md-ellipsis">
      
        ros_time_to_sec
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation.metrics.save_map_image" class="md-nav__link">
    <span class="md-ellipsis">
      
        save_map_image
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="evaluation-module">Evaluation Module</h1>


<div class="doc doc-object doc-module">



<h2 id="evaluation.metrics" class="doc doc-heading">
            <code>evaluation.metrics</code>


</h2>

    <div class="doc doc-contents first">

        <p>Skeleton evaluation script for frontier-based exploration runs.</p>
<p>What it does:
- Loads a GT occupancy grid map from a YAML + PGM.
- Reads a ros2 bag (rosbag2) with topics:
    - /map  (nav_msgs/OccupancyGrid)
    - /odom (nav_msgs/Odometry)
- Computes:
    - time_to_50, time_to_80, time_to_90 percent coverage
    - final occupancy IoU vs GT
    - total path length from /odom</p>


<details class="requirements" open>
  <summary>Requirements</summary>
  <ul>
<li>ROS 2 Python environment (source your ROS 2 + workspace)</li>
<li>rosbag2_py</li>
<li>numpy</li>
<li>opencv-python</li>
<li>pyyaml</li>
</ul>
</details>        <p>This is a skeleton: adjust topic names, thresholds,
and map alignment to your setup.</p>










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="evaluation.metrics.align_est_map_to_gt" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">align_est_map_to_gt</span><span class="p">(</span><span class="n">gt_map</span><span class="p">,</span> <span class="n">gt_res</span><span class="p">,</span> <span class="n">gt_origin</span><span class="p">,</span> <span class="n">est_msg</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Projette une OccupancyGrid 'est_msg' dans le repère de la carte GT
en utilisant les origines + résolution (on suppose pas de rotation).</p>
<p>Retourne une grille de même taille que gt_map, remplie avec:
    - valeurs de la carte estimée là où c'est défini
    - -1 ailleurs</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>evaluation/metrics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="k">def</span><span class="w"> </span><span class="nf">align_est_map_to_gt</span><span class="p">(</span><span class="n">gt_map</span><span class="p">,</span> <span class="n">gt_res</span><span class="p">,</span> <span class="n">gt_origin</span><span class="p">,</span> <span class="n">est_msg</span><span class="p">):</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">    Projette une OccupancyGrid &#39;est_msg&#39; dans le repère de la carte GT</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="sd">    en utilisant les origines + résolution (on suppose pas de rotation).</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="sd">    Retourne une grille de même taille que gt_map, remplie avec:</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="sd">        - valeurs de la carte estimée là où c&#39;est défini</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="sd">        - -1 ailleurs</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>    <span class="n">gt_h</span><span class="p">,</span> <span class="n">gt_w</span> <span class="o">=</span> <span class="n">gt_map</span><span class="o">.</span><span class="n">shape</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>    <span class="n">est_res</span> <span class="o">=</span> <span class="n">est_msg</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">resolution</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>    <span class="n">est_w</span> <span class="o">=</span> <span class="n">est_msg</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">width</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>    <span class="n">est_h</span> <span class="o">=</span> <span class="n">est_msg</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">height</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>    <span class="c1"># on suppose résolutions identiques (slam_toolbox + map_saver)</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">est_res</span> <span class="o">-</span> <span class="n">gt_res</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-6</span><span class="p">:</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARN] est_res=</span><span class="si">{</span><span class="n">est_res</span><span class="si">}</span><span class="s2"> != gt_res=</span><span class="si">{</span><span class="n">gt_res</span><span class="si">}</span><span class="s2">, on applique un facteur d&#39;échelle.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>    <span class="n">scale</span> <span class="o">=</span> <span class="n">est_res</span> <span class="o">/</span> <span class="n">gt_res</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>    <span class="n">gt_origin_x</span><span class="p">,</span> <span class="n">gt_origin_y</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">gt_origin</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>    <span class="n">est_origin_x</span> <span class="o">=</span> <span class="n">est_msg</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">origin</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">x</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>    <span class="n">est_origin_y</span> <span class="o">=</span> <span class="n">est_msg</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">origin</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">y</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] GT map: </span><span class="si">{</span><span class="n">gt_w</span><span class="si">}</span><span class="s2">x</span><span class="si">{</span><span class="n">gt_h</span><span class="si">}</span><span class="s2">, res=</span><span class="si">{</span><span class="n">gt_res</span><span class="si">}</span><span class="s2">, origin=(</span><span class="si">{</span><span class="n">gt_origin_x</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">gt_origin_y</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] Est map: </span><span class="si">{</span><span class="n">est_w</span><span class="si">}</span><span class="s2">x</span><span class="si">{</span><span class="n">est_h</span><span class="si">}</span><span class="s2">, res=</span><span class="si">{</span><span class="n">est_res</span><span class="si">}</span><span class="s2">, origin=(</span><span class="si">{</span><span class="n">est_origin_x</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">est_origin_y</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>    <span class="n">est_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">est_msg</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>    <span class="n">est_grid</span> <span class="o">=</span> <span class="n">est_flat</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">est_h</span><span class="p">,</span> <span class="n">est_w</span><span class="p">))</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>    <span class="c1"># Count known cells in estimated map</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>    <span class="n">known_cells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">est_grid</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>    <span class="n">free_cells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">est_grid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>    <span class="n">occupied_cells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">est_grid</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">)</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] Est map stats: </span><span class="si">{</span><span class="n">known_cells</span><span class="si">}</span><span class="s2"> known (</span><span class="si">{</span><span class="n">free_cells</span><span class="si">}</span><span class="s2"> free, </span><span class="si">{</span><span class="n">occupied_cells</span><span class="si">}</span><span class="s2"> occupied)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>    <span class="c1"># carte de sortie dans le repère GT</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>    <span class="n">est_on_gt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">gt_map</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>    <span class="n">cells_mapped</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>    <span class="c1"># IMPORTANT: The GT map generator uses np.flipud() when saving the PGM</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>    <span class="c1"># This means when we load it with cv2.imread, it&#39;s ALREADY in ROS convention</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>    <span class="c1"># (row 0 = bottom, increasing row = increasing Y in world coordinates)</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>    <span class="c1"># So we DON&#39;T need to flip the Y coordinate - use same logic as X</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>    <span class="c1"># boucle sur les cellules de la carte estimée</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">est_h</span><span class="p">):</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">est_w</span><span class="p">):</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>            <span class="n">val</span> <span class="o">=</span> <span class="n">est_grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>            <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>                <span class="k">continue</span>  <span class="c1"># inconnue, on ignore</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>            <span class="c1"># coord monde (centre de cellule)</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>            <span class="c1"># In ROS OccupancyGrid, row i corresponds to y = origin_y + i * resolution</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>            <span class="n">world_x</span> <span class="o">=</span> <span class="n">est_origin_x</span> <span class="o">+</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">est_res</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>            <span class="n">world_y</span> <span class="o">=</span> <span class="n">est_origin_y</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">est_res</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>            <span class="c1"># Transform to GT map indices</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>            <span class="c1"># Both X and Y use the same logic since GT is already in ROS convention</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>            <span class="n">gt_j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">world_x</span> <span class="o">-</span> <span class="n">gt_origin_x</span><span class="p">)</span> <span class="o">/</span> <span class="n">gt_res</span><span class="p">)</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>            <span class="n">gt_i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">world_y</span> <span class="o">-</span> <span class="n">gt_origin_y</span><span class="p">)</span> <span class="o">/</span> <span class="n">gt_res</span><span class="p">)</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">gt_i</span> <span class="o">&lt;</span> <span class="n">gt_h</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">gt_j</span> <span class="o">&lt;</span> <span class="n">gt_w</span><span class="p">:</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>                <span class="n">est_on_gt</span><span class="p">[</span><span class="n">gt_i</span><span class="p">,</span> <span class="n">gt_j</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>                <span class="n">cells_mapped</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] Cells successfully mapped to GT: </span><span class="si">{</span><span class="n">cells_mapped</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>    <span class="k">return</span> <span class="n">est_on_gt</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="evaluation.metrics.compute_accessible_coverage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_accessible_coverage</span><span class="p">(</span><span class="n">gt_map</span><span class="p">,</span> <span class="n">est_map</span><span class="p">,</span> <span class="n">gt_res</span><span class="p">,</span> <span class="n">gt_origin</span><span class="p">,</span> <span class="n">est_origin</span><span class="p">,</span> <span class="n">est_width</span><span class="p">,</span> <span class="n">est_height</span><span class="p">,</span> <span class="n">est_res</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Coverage of the ACTUAL accessible area (Reachability analysis on GT map).
Defines 'Accessible' as the connected component of free space in the GT map
that corresponds to the area strictly explored/seen by the robot.</p>
<p>This handles cases where the GT map has a large "outside" free area that is 
unreachable (separated by walls), preventing the "largest component" heuristic 
from picking the wrong area.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>gt_map</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Ground truth occupancy grid (0=Free, 100=Occ, -1=Unk)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>est_map</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Estimated map aligned to GT (0=Free, 100=Occ, -1=Unk)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>evaluation/metrics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-320" name="__codelineno-0-320"></a><span class="k">def</span><span class="w"> </span><span class="nf">compute_accessible_coverage</span><span class="p">(</span><span class="n">gt_map</span><span class="p">,</span> <span class="n">est_map</span><span class="p">,</span> <span class="n">gt_res</span><span class="p">,</span> <span class="n">gt_origin</span><span class="p">,</span> <span class="n">est_origin</span><span class="p">,</span> <span class="n">est_width</span><span class="p">,</span> <span class="n">est_height</span><span class="p">,</span> <span class="n">est_res</span><span class="p">):</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a><span class="sd">    Coverage of the ACTUAL accessible area (Reachability analysis on GT map).</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="sd">    Defines &#39;Accessible&#39; as the connected component of free space in the GT map</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a><span class="sd">    that corresponds to the area strictly explored/seen by the robot.</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="sd">    This handles cases where the GT map has a large &quot;outside&quot; free area that is </span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="sd">    unreachable (separated by walls), preventing the &quot;largest component&quot; heuristic </span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="sd">    from picking the wrong area.</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a><span class="sd">        gt_map: Ground truth occupancy grid (0=Free, 100=Occ, -1=Unk)</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="sd">        est_map: Estimated map aligned to GT (0=Free, 100=Occ, -1=Unk)</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>    <span class="c1"># 1. Identify Accessible Space candidates</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>    <span class="n">gt_free</span> <span class="o">=</span> <span class="p">(</span><span class="n">gt_map</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>    <span class="k">if</span> <span class="n">gt_free</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>        <span class="k">return</span> <span class="mf">0.0</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>    <span class="c1"># Label connected components (8-connectivity)</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>    <span class="n">num_labels</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">centroids</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">connectedComponentsWithStats</span><span class="p">(</span><span class="n">gt_free</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>    <span class="c1"># Background is label 0. labels 1..N are components.</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>    <span class="k">if</span> <span class="n">num_labels</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>        <span class="k">return</span> <span class="mf">0.0</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>    <span class="c1"># 2. Find the component that matches the robot&#39;s location/map</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>    <span class="c1"># We look for the component that has the most overlap with the ESTIMATED Free Space.</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>    <span class="n">est_free</span> <span class="o">=</span> <span class="p">(</span><span class="n">est_map</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>    <span class="n">best_label</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>    <span class="n">max_overlap</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>    <span class="c1"># Heuristic: If est_map is empty (no free space), fall back to largest component</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>    <span class="k">if</span> <span class="n">est_free</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>        <span class="c1"># Fallback: largest area</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>        <span class="n">best_label</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>        <span class="n">max_overlap</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CC_STAT_AREA</span><span class="p">]</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">num_labels</span><span class="p">):</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>            <span class="n">area</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CC_STAT_AREA</span><span class="p">]</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>            <span class="k">if</span> <span class="n">area</span> <span class="o">&gt;</span> <span class="n">max_overlap</span><span class="p">:</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>                <span class="n">max_overlap</span> <span class="o">=</span> <span class="n">area</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>                <span class="n">best_label</span> <span class="o">=</span> <span class="n">i</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>        <span class="c1"># Check overlap for each component</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>        <span class="c1"># Optimization: We can just use the labels imagemasked by est_free to count occurances</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>        <span class="c1"># BUT: est_free might cross walls due to SLAM errors.</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>        <span class="c1"># We want the component with the *highest number of shared pixels*.</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>        <span class="c1"># Fast way using numpy bincount on the masked labels</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>        <span class="c1"># labels[est_free] gives all label IDs under the free pixels of estimated map</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>        <span class="n">masked_labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">est_free</span><span class="p">]</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>        <span class="k">if</span> <span class="n">masked_labels</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>            <span class="c1"># bincount accounts for 0 (background) too, so logic holds</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>            <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">masked_labels</span><span class="p">,</span> <span class="n">minlength</span><span class="o">=</span><span class="n">num_labels</span><span class="p">)</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>            <span class="c1"># We ignore label 0 (background)</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>            <span class="n">counts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>            <span class="n">best_label</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>            <span class="c1"># If for some reason overlap is 0 (unlikely if est_free &gt; 0), fallback</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>            <span class="k">if</span> <span class="n">counts</span><span class="p">[</span><span class="n">best_label</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>                 <span class="n">best_label</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CC_STAT_AREA</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>             <span class="n">best_label</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CC_STAT_AREA</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>    <span class="n">accessible_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">labels</span> <span class="o">==</span> <span class="n">best_label</span><span class="p">)</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>    <span class="n">total_accessible</span> <span class="o">=</span> <span class="n">accessible_mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>    <span class="k">if</span> <span class="n">total_accessible</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>        <span class="k">return</span> <span class="mf">0.0</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>    <span class="c1"># 3. Compute Coverage</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>    <span class="c1"># Check which pixels in the accessible mask are &quot;known&quot; in the estimated map</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>    <span class="n">est_known</span> <span class="o">=</span> <span class="p">(</span><span class="n">est_map</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>    <span class="n">covered_accessible</span> <span class="o">=</span> <span class="p">(</span><span class="n">accessible_mask</span> <span class="o">&amp;</span> <span class="n">est_known</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>    <span class="k">return</span> <span class="n">covered_accessible</span> <span class="o">/</span> <span class="n">total_accessible</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="evaluation.metrics.compute_coverage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_coverage</span><span class="p">(</span><span class="n">gt_map</span><span class="p">,</span> <span class="n">est_map</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Coverage: fraction of free GT cells that are known (free or occupied) in est_map.
This measures coverage of the ENTIRE GT map.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>evaluation/metrics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="k">def</span><span class="w"> </span><span class="nf">compute_coverage</span><span class="p">(</span><span class="n">gt_map</span><span class="p">,</span> <span class="n">est_map</span><span class="p">):</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a><span class="sd">    Coverage: fraction of free GT cells that are known (free or occupied) in est_map.</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a><span class="sd">    This measures coverage of the ENTIRE GT map.</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>    <span class="n">gt_free</span> <span class="o">=</span> <span class="p">(</span><span class="n">gt_map</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>    <span class="n">est_known</span> <span class="o">=</span> <span class="p">(</span><span class="n">est_map</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>    <span class="k">if</span> <span class="n">gt_free</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>        <span class="k">return</span> <span class="mf">0.0</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>    <span class="n">covered</span> <span class="o">=</span> <span class="p">(</span><span class="n">gt_free</span> <span class="o">&amp;</span> <span class="n">est_known</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>    <span class="k">return</span> <span class="n">covered</span> <span class="o">/</span> <span class="n">gt_free</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="evaluation.metrics.compute_iou" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_iou</span><span class="p">(</span><span class="n">gt_map</span><span class="p">,</span> <span class="n">est_map</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>IoU over OCCUPIED cells (100 vs &gt;50 threshold).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>evaluation/metrics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="k">def</span><span class="w"> </span><span class="nf">compute_iou</span><span class="p">(</span><span class="n">gt_map</span><span class="p">,</span> <span class="n">est_map</span><span class="p">):</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">    IoU over OCCUPIED cells (100 vs &gt;50 threshold).</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>    <span class="n">gt_occ</span> <span class="o">=</span> <span class="p">(</span><span class="n">gt_map</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">)</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>    <span class="n">est_occ</span> <span class="o">=</span> <span class="p">(</span><span class="n">est_map</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">)</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>    <span class="n">intersection</span> <span class="o">=</span> <span class="p">(</span><span class="n">gt_occ</span> <span class="o">&amp;</span> <span class="n">est_occ</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>    <span class="n">union</span> <span class="o">=</span> <span class="p">(</span><span class="n">gt_occ</span> <span class="o">|</span> <span class="n">est_occ</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">intersection</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">union</span><span class="p">)</span> <span class="k">if</span> <span class="n">union</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="evaluation.metrics.compute_path_length" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_path_length</span><span class="p">(</span><span class="n">odom_msgs</span><span class="p">,</span> <span class="n">bag_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Integrate path length from /odom messages.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>evaluation/metrics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-491" name="__codelineno-0-491"></a><span class="k">def</span><span class="w"> </span><span class="nf">compute_path_length</span><span class="p">(</span><span class="n">odom_msgs</span><span class="p">,</span> <span class="n">bag_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a><span class="sd">    Integrate path length from /odom messages.</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">odom_msgs</span><span class="p">:</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>        <span class="k">return</span> <span class="mf">0.0</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>    <span class="n">prev_x</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>    <span class="n">prev_y</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>    <span class="n">length</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>    <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">odom_msgs</span><span class="p">:</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">x</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">y</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>        <span class="k">if</span> <span class="n">prev_x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>            <span class="n">dx</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">prev_x</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>            <span class="n">dy</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">prev_y</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>            <span class="n">length</span> <span class="o">+=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">*</span><span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>        <span class="n">prev_x</span><span class="p">,</span> <span class="n">prev_y</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>    <span class="k">return</span> <span class="n">length</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="evaluation.metrics.compute_ssim" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_ssim</span><span class="p">(</span><span class="n">gt_map</span><span class="p">,</span> <span class="n">est_map</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Compute Structural Similarity Index (SSIM) between maps.
Only considers common known areas.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>evaluation/metrics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-412" name="__codelineno-0-412"></a><span class="k">def</span><span class="w"> </span><span class="nf">compute_ssim</span><span class="p">(</span><span class="n">gt_map</span><span class="p">,</span> <span class="n">est_map</span><span class="p">):</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a><span class="sd">    Compute Structural Similarity Index (SSIM) between maps.</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a><span class="sd">    Only considers common known areas.</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">SKIMAGE_AVAILABLE</span><span class="p">:</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>        <span class="k">return</span> <span class="mf">0.0</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>    <span class="c1"># 1. Prepare normalized maps (0-1)</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>    <span class="c1"># Treat unknown (-1) as 0.5 for a &quot;neutral&quot; background or mask them</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">gt_map</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">est_map</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>        <span class="k">return</span> <span class="mf">0.0</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>    <span class="c1"># Convert to float [0, 1]</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>    <span class="n">gt_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">gt_map</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>    <span class="n">est_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">est_map</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>    <span class="c1"># Compute SSIM on the whole image but focus on the relevant part</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>    <span class="n">score</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ssim</span><span class="p">(</span><span class="n">gt_norm</span><span class="p">,</span> <span class="n">est_norm</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">data_range</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>    <span class="c1"># Optional: localized SSIM only on known cells</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="evaluation.metrics.compute_time_to_coverage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_time_to_coverage</span><span class="p">(</span><span class="n">gt_map</span><span class="p">,</span> <span class="n">gt_res</span><span class="p">,</span> <span class="n">gt_origin</span><span class="p">,</span> <span class="n">map_msgs</span><span class="p">,</span> <span class="n">thresholds</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Compute time to reach each coverage threshold using
un alignement correct est-&gt;GT pour chaque carte.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>evaluation/metrics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-468" name="__codelineno-0-468"></a><span class="k">def</span><span class="w"> </span><span class="nf">compute_time_to_coverage</span><span class="p">(</span><span class="n">gt_map</span><span class="p">,</span> <span class="n">gt_res</span><span class="p">,</span> <span class="n">gt_origin</span><span class="p">,</span> <span class="n">map_msgs</span><span class="p">,</span> <span class="n">thresholds</span><span class="p">):</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a><span class="sd">    Compute time to reach each coverage threshold using</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="sd">    un alignement correct est-&gt;GT pour chaque carte.</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>    <span class="n">times_to_cov</span> <span class="o">=</span> <span class="p">{</span><span class="n">th</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">th</span> <span class="ow">in</span> <span class="n">thresholds</span><span class="p">}</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>    <span class="n">reached</span> <span class="o">=</span> <span class="p">{</span><span class="n">th</span><span class="p">:</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">th</span> <span class="ow">in</span> <span class="n">thresholds</span><span class="p">}</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>    <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">map_msgs</span><span class="p">:</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>        <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">width</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">msg</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">height</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>            <span class="k">continue</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>        <span class="n">est_on_gt</span> <span class="o">=</span> <span class="n">align_est_map_to_gt</span><span class="p">(</span><span class="n">gt_map</span><span class="p">,</span> <span class="n">gt_res</span><span class="p">,</span> <span class="n">gt_origin</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>        <span class="n">cov</span> <span class="o">=</span> <span class="n">compute_coverage</span><span class="p">(</span><span class="n">gt_map</span><span class="p">,</span> <span class="n">est_on_gt</span><span class="p">)</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>        <span class="k">for</span> <span class="n">th</span> <span class="ow">in</span> <span class="n">thresholds</span><span class="p">:</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">reached</span><span class="p">[</span><span class="n">th</span><span class="p">]</span> <span class="ow">and</span> <span class="n">cov</span> <span class="o">&gt;=</span> <span class="n">th</span><span class="p">:</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>                <span class="n">times_to_cov</span><span class="p">[</span><span class="n">th</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>                <span class="n">reached</span><span class="p">[</span><span class="n">th</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>    <span class="k">return</span> <span class="n">times_to_cov</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="evaluation.metrics.compute_wall_thickness" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_wall_thickness</span><span class="p">(</span><span class="n">map_array</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Estimate the average thickness of walls in the map (in meters).
Uses Distance Transform on occupied cells.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>evaluation/metrics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-438" name="__codelineno-0-438"></a><span class="k">def</span><span class="w"> </span><span class="nf">compute_wall_thickness</span><span class="p">(</span><span class="n">map_array</span><span class="p">,</span> <span class="n">resolution</span><span class="p">):</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a><span class="sd">    Estimate the average thickness of walls in the map (in meters).</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="sd">    Uses Distance Transform on occupied cells.</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">SKIMAGE_AVAILABLE</span><span class="p">:</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>        <span class="k">return</span> <span class="mf">0.0</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>    <span class="c1"># Occupied mask</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>    <span class="n">occ</span> <span class="o">=</span> <span class="p">(</span><span class="n">map_array</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">occ</span><span class="p">):</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>        <span class="k">return</span> <span class="mf">0.0</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>    <span class="c1"># Skeletonize to find center lines</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>        <span class="n">skel</span> <span class="o">=</span> <span class="n">skeletonize</span><span class="p">(</span><span class="n">occ</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>    <span class="k">except</span><span class="p">:</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>        <span class="k">return</span> <span class="mf">0.0</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">skel</span><span class="p">):</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>        <span class="k">return</span> <span class="mf">0.0</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>    <span class="c1"># Distance transform from background (non-wall)</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>    <span class="n">dist</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">distanceTransform</span><span class="p">(</span><span class="n">occ</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">DIST_L2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>    <span class="c1"># The thickness is roughly twice the distance from the center line to the edge</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>    <span class="n">thickness_cells</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dist</span><span class="p">[</span><span class="n">skel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>    <span class="k">return</span> <span class="n">thickness_cells</span> <span class="o">*</span> <span class="n">resolution</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="evaluation.metrics.detect_anomalies" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">detect_anomalies</span><span class="p">(</span><span class="n">odom_msgs</span><span class="p">,</span> <span class="n">ate_rmse</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Heuristic-based failure detection.
Returns: (list of warning strings, is_failure boolean)</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>evaluation/metrics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-559" name="__codelineno-0-559"></a><span class="k">def</span><span class="w"> </span><span class="nf">detect_anomalies</span><span class="p">(</span><span class="n">odom_msgs</span><span class="p">,</span> <span class="n">ate_rmse</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a><span class="sd">    Heuristic-based failure detection.</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a><span class="sd">    Returns: (list of warning strings, is_failure boolean)</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>    <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>    <span class="n">is_failure</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">odom_msgs</span><span class="p">:</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>        <span class="k">return</span> <span class="p">([</span><span class="s2">&quot;No odometry data found.&quot;</span><span class="p">],</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>    <span class="c1"># 1. Minimum Movement Check</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>    <span class="n">total_dist</span> <span class="o">=</span> <span class="n">compute_path_length</span><span class="p">(</span><span class="n">odom_msgs</span><span class="p">)</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>    <span class="k">if</span> <span class="n">total_dist</span> <span class="o">&lt;</span> <span class="mf">0.2</span><span class="p">:</span> <span class="c1"># Less than 20cm</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Robot barely moved (Stuck/Process fail)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>        <span class="n">is_failure</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>    <span class="c1"># 2. Velocity / Jump Check</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>    <span class="c1"># TB3 max speed is ~0.26 m/s. Let&#39;s flag anything &gt; 1.5 m/s as a TF Jump</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>    <span class="n">max_jump</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">odom_msgs</span><span class="p">)):</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>        <span class="n">t1</span><span class="p">,</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">odom_msgs</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>        <span class="n">t2</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">odom_msgs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>        <span class="n">dt</span> <span class="o">=</span> <span class="n">t2</span> <span class="o">-</span> <span class="n">t1</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>        <span class="k">if</span> <span class="n">dt</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span> <span class="k">continue</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>        <span class="n">dx</span> <span class="o">=</span> <span class="n">p2</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">p1</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">x</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>        <span class="n">dy</span> <span class="o">=</span> <span class="n">p2</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">p1</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">y</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>        <span class="n">dist</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">*</span><span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>        <span class="n">vel</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">/</span> <span class="n">dt</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>        <span class="k">if</span> <span class="n">vel</span> <span class="o">&gt;</span> <span class="mf">1.5</span><span class="p">:</span> 
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>            <span class="n">max_jump</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_jump</span><span class="p">,</span> <span class="n">vel</span><span class="p">)</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>    <span class="k">if</span> <span class="n">max_jump</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Major TF Jump detected! (Max speed pulse: </span><span class="si">{</span><span class="n">max_jump</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> m/s)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>        <span class="n">is_failure</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>    <span class="c1"># 3. Accuracy Fail</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>    <span class="k">if</span> <span class="n">ate_rmse</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ate_rmse</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Massive drift detected! (ATE RMSE: </span><span class="si">{</span><span class="n">ate_rmse</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> m)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>        <span class="n">is_failure</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>    <span class="k">return</span> <span class="n">warnings</span><span class="p">,</span> <span class="n">is_failure</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="evaluation.metrics.get_trajectory" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_trajectory</span><span class="p">(</span><span class="n">odom_msgs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Extract x, y points from a list of (timestamp, msg) odom messages.
Returns: (list_x, list_y)</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>evaluation/metrics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-516" name="__codelineno-0-516"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_trajectory</span><span class="p">(</span><span class="n">odom_msgs</span><span class="p">):</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a><span class="sd">    Extract x, y points from a list of (timestamp, msg) odom messages.</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a><span class="sd">    Returns: (list_x, list_y)</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>    <span class="n">tx</span><span class="p">,</span> <span class="n">ty</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">odom_msgs</span><span class="p">:</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>        <span class="n">tx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>        <span class="n">ty</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>    <span class="k">return</span> <span class="n">tx</span><span class="p">,</span> <span class="n">ty</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="evaluation.metrics.load_gt_map" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_gt_map</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Load ground-truth map from <name>.yaml + <name>.pgm.
Returns:
    gt_occ_grid: np.ndarray of shape (H, W) with int8 data (0..100, -1 for unknown)
    resolution: float (m/cell)
    origin: (x, y, yaw) of map in world frame</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>evaluation/metrics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_gt_map</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">    Load ground-truth map from &lt;name&gt;.yaml + &lt;name&gt;.pgm.</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">        gt_occ_grid: np.ndarray of shape (H, W) with int8 data (0..100, -1 for unknown)</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">        resolution: float (m/cell)</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">        origin: (x, y, yaw) of map in world frame</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="n">info</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span class="n">pgm_path</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">pgm_path</span><span class="p">):</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>        <span class="n">pgm_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">),</span> <span class="n">pgm_path</span><span class="p">)</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="c1"># load pgm as grayscale</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">pgm_path</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_UNCHANGED</span><span class="p">)</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>    <span class="k">if</span> <span class="n">img</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to load PGM map from: </span><span class="si">{</span><span class="n">pgm_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="c1"># YAML fields (nav2/slam_toolbox convention)</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="n">resolution</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">])</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="n">origin</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;origin&quot;</span><span class="p">]</span>   <span class="c1"># [x, y, yaw]</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="n">negate</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;negate&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="n">occupied_thresh</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;occupied_thresh&quot;</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">))</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="n">free_thresh</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;free_thresh&quot;</span><span class="p">,</span> <span class="mf">0.196</span><span class="p">))</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>    <span class="c1"># Convert PGM to occupancy values [0..100] + -1 for unknown</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="c1"># Here&#39;s a simple heuristic; you may want to tune it to your pipeline.</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="n">img_norm</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.0</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="k">if</span> <span class="n">negate</span><span class="p">:</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="n">img_norm</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">img_norm</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="n">gt_occ_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">img_norm</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="c1"># Standard PGM: White (255) is Free, Black (0) is Occupied</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="c1"># High value &gt; occupied_thresh (0.65) -&gt; Free (0)</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="c1"># Low value &lt; free_thresh (0.196) -&gt; Occupied (100)</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>    <span class="c1"># Note: ROS map_server docs say &quot;occupied_thresh&quot; determines occupied, </span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="c1"># but usually pixels &lt; free_thresh are free?</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="c1"># Actually map_server:</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="c1"># &quot;Pixels with brightness greater than free_thresh are considered free... (Wait no)&quot;</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="c1"># Standard: p &gt; occ_th -&gt; Occupied. p &lt; free_th -&gt; Free.</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>    <span class="c1"># BUT: </span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="c1"># If negate=0 (Black is occupied).</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="c1"># Then p (brightness) is LOW for occupied.</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="c1"># So if p &lt; threshold -&gt; Occupied.</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="c1"># The variable &quot;occupied_thresh&quot; in YAML usually means probability?</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="c1"># No, YAML has &quot;occupied_thresh&quot; (default 0.65). </span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="c1"># Interpretation depends on mode.</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="c1"># </span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="c1"># Let&#39;s assume standard &quot;Black is Walls&quot;.</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>    <span class="c1"># Black = 0. White = 1.</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="c1"># Walls are 0.</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="c1"># So if img_norm &lt; free_thresh -&gt; Occupied.</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>    <span class="n">gt_occ_grid</span><span class="p">[</span><span class="n">img_norm</span> <span class="o">&gt;</span> <span class="n">occupied_thresh</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>    <span class="c1"># White -&gt; Free</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="n">gt_occ_grid</span><span class="p">[</span><span class="n">img_norm</span> <span class="o">&lt;</span> <span class="n">free_thresh</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>      <span class="c1"># Black -&gt; Occupied</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="c1"># Flip the map to match ROS convention (Top-Down image -&gt; Bottom-Up grid)</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="c1"># ROS map origin is bottom-left, but image origin is top-left.</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="n">gt_occ_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">gt_occ_grid</span><span class="p">)</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="k">return</span> <span class="n">gt_occ_grid</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">origin</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="evaluation.metrics.occupancy_arrays_from_msgs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">occupancy_arrays_from_msgs</span><span class="p">(</span><span class="n">map_msgs</span><span class="p">,</span> <span class="n">gt_map</span><span class="p">,</span> <span class="n">gt_res</span><span class="p">,</span> <span class="n">gt_origin</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Utilise le dernier /map et l'aligne correctement sur la GT
en utilisant les origines + résolution.
Returns: (est_on_gt, last_map_msg)</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>evaluation/metrics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="k">def</span><span class="w"> </span><span class="nf">occupancy_arrays_from_msgs</span><span class="p">(</span><span class="n">map_msgs</span><span class="p">,</span> <span class="n">gt_map</span><span class="p">,</span> <span class="n">gt_res</span><span class="p">,</span> <span class="n">gt_origin</span><span class="p">):</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">    Utilise le dernier /map et l&#39;aligne correctement sur la GT</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">    en utilisant les origines + résolution.</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="sd">    Returns: (est_on_gt, last_map_msg)</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">map_msgs</span><span class="p">:</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;No /map messages found in bag.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>    <span class="n">_</span><span class="p">,</span> <span class="n">last_map</span> <span class="o">=</span> <span class="n">map_msgs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>    <span class="n">est_on_gt</span> <span class="o">=</span> <span class="n">align_est_map_to_gt</span><span class="p">(</span><span class="n">gt_map</span><span class="p">,</span> <span class="n">gt_res</span><span class="p">,</span> <span class="n">gt_origin</span><span class="p">,</span> <span class="n">last_map</span><span class="p">)</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>    <span class="k">return</span> <span class="n">est_on_gt</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="evaluation.metrics.open_bag_reader" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">open_bag_reader</span><span class="p">(</span><span class="n">bag_path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Open a ros2 bag for reading, auto-detecting storage format.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>evaluation/metrics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="k">def</span><span class="w"> </span><span class="nf">open_bag_reader</span><span class="p">(</span><span class="n">bag_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SequentialReader</span><span class="p">:</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Open a ros2 bag for reading, auto-detecting storage format.&quot;&quot;&quot;</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="c1"># Try different storage formats</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="n">storage_formats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;sqlite3&quot;</span><span class="p">,</span> <span class="s2">&quot;mcap&quot;</span><span class="p">]</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="k">for</span> <span class="n">storage_id</span> <span class="ow">in</span> <span class="n">storage_formats</span><span class="p">:</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>            <span class="n">storage_options</span> <span class="o">=</span> <span class="n">StorageOptions</span><span class="p">(</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>                <span class="n">uri</span><span class="o">=</span><span class="n">bag_path</span><span class="p">,</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>                <span class="n">storage_id</span><span class="o">=</span><span class="n">storage_id</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>            <span class="p">)</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>            <span class="n">converter_options</span> <span class="o">=</span> <span class="n">ConverterOptions</span><span class="p">(</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>                <span class="n">input_serialization_format</span><span class="o">=</span><span class="s2">&quot;cdr&quot;</span><span class="p">,</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>                <span class="n">output_serialization_format</span><span class="o">=</span><span class="s2">&quot;cdr&quot;</span><span class="p">,</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>            <span class="p">)</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>            <span class="n">reader</span> <span class="o">=</span> <span class="n">SequentialReader</span><span class="p">()</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>            <span class="n">reader</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">storage_options</span><span class="p">,</span> <span class="n">converter_options</span><span class="p">)</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>            <span class="k">return</span> <span class="n">reader</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>            <span class="k">if</span> <span class="n">storage_id</span> <span class="o">==</span> <span class="n">storage_formats</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>                <span class="c1"># Last format failed, raise error</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>                    <span class="sa">f</span><span class="s2">&quot;Failed to open rosbag at &#39;</span><span class="si">{</span><span class="n">bag_path</span><span class="si">}</span><span class="s2">&#39;. &quot;</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>                    <span class="sa">f</span><span class="s2">&quot;Tried formats: </span><span class="si">{</span><span class="n">storage_formats</span><span class="si">}</span><span class="s2">. &quot;</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>                    <span class="sa">f</span><span class="s2">&quot;Make sure the path points to a valid ROS2 bag directory. &quot;</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>                    <span class="sa">f</span><span class="s2">&quot;Last error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>                <span class="p">)</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>            <span class="c1"># Try next format</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>            <span class="k">continue</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="evaluation.metrics.read_messages_by_topic" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_messages_by_topic</span><span class="p">(</span><span class="n">bag_path</span><span class="p">,</span> <span class="n">topics_of_interest</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Read all messages from a ros2 bag for given topics.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>{ topic_name: [(timestamp_sec, msg), ...] }</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>evaluation/metrics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="k">def</span><span class="w"> </span><span class="nf">read_messages_by_topic</span><span class="p">(</span><span class="n">bag_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">topics_of_interest</span><span class="p">):</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">    Read all messages from a ros2 bag for given topics.</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">        dict: { topic_name: [(timestamp_sec, msg), ...] }</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="n">reader</span> <span class="o">=</span> <span class="n">open_bag_reader</span><span class="p">(</span><span class="n">bag_path</span><span class="p">)</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot open rosbag: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>    <span class="c1"># Map topic name -&gt; type string</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="n">topic_types</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>    <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">reader</span><span class="o">.</span><span class="n">get_all_topics_and_types</span><span class="p">():</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>        <span class="n">topic_types</span><span class="p">[</span><span class="n">topic</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic</span><span class="o">.</span><span class="n">type</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>    <span class="c1"># Prepare message classes only for the topics we care about</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>    <span class="n">msg_classes</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>    <span class="k">for</span> <span class="n">tname</span> <span class="ow">in</span> <span class="n">topics_of_interest</span><span class="p">:</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>        <span class="k">if</span> <span class="n">tname</span> <span class="ow">in</span> <span class="n">topic_types</span><span class="p">:</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>            <span class="n">msg_classes</span><span class="p">[</span><span class="n">tname</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_message</span><span class="p">(</span><span class="n">topic_types</span><span class="p">[</span><span class="n">tname</span><span class="p">])</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>    <span class="n">messages</span> <span class="o">=</span> <span class="p">{</span><span class="n">t</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">topics_of_interest</span><span class="p">}</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>    <span class="k">while</span> <span class="n">reader</span><span class="o">.</span><span class="n">has_next</span><span class="p">():</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>        <span class="n">topic_name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read_next</span><span class="p">()</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>        <span class="k">if</span> <span class="n">topic_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">topics_of_interest</span><span class="p">:</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>            <span class="k">continue</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>        <span class="n">msg_cls</span> <span class="o">=</span> <span class="n">msg_classes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">topic_name</span><span class="p">)</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="k">if</span> <span class="n">msg_cls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>            <span class="c1"># topic not in our interest list or type unknown</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>            <span class="k">continue</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>        <span class="c1"># ✅ correct way: use rclpy.serialization</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>        <span class="n">msg</span> <span class="o">=</span> <span class="n">deserialize_message</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">msg_cls</span><span class="p">)</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>        <span class="c1"># t is nanoseconds since bag start (int) in rosbag2; convert to seconds</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>        <span class="n">timestamp_sec</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-9</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>        <span class="n">messages</span><span class="p">[</span><span class="n">topic_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">timestamp_sec</span><span class="p">,</span> <span class="n">msg</span><span class="p">))</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>    <span class="c1"># sort by time</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">:</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>        <span class="n">messages</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>    <span class="k">return</span> <span class="n">messages</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="evaluation.metrics.ros_time_to_sec" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ros_time_to_sec</span><span class="p">(</span><span class="n">t</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Convert builtin_interfaces/Time to seconds (float).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>evaluation/metrics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="k">def</span><span class="w"> </span><span class="nf">ros_time_to_sec</span><span class="p">(</span><span class="n">t</span><span class="p">:</span> <span class="n">RosTime</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert builtin_interfaces/Time to seconds (float).&quot;&quot;&quot;</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">sec</span><span class="p">)</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">nanosec</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-9</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="evaluation.metrics.save_map_image" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_map_image</span><span class="p">(</span><span class="n">map_array</span><span class="p">,</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Save the occupancy grid as an image.
map_array: 2D numpy array (0-100, -1).
output_path: path to save the image.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>evaluation/metrics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-529" name="__codelineno-0-529"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_map_image</span><span class="p">(</span><span class="n">map_array</span><span class="p">,</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a><span class="sd">    Save the occupancy grid as an image.</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a><span class="sd">    map_array: 2D numpy array (0-100, -1).</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a><span class="sd">    output_path: path to save the image.</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>    <span class="c1"># Normalize for visualization:</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>    <span class="c1"># -1 (unknown) -&gt; 127 (gray)</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>    <span class="c1"># 0 (free) -&gt; 255 (white)</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>    <span class="c1"># 100 (occupied) -&gt; 0 (black)</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>    <span class="n">vis_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">map_array</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>    <span class="n">vis_map</span><span class="p">[</span><span class="n">map_array</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>    <span class="n">vis_map</span><span class="p">[</span><span class="n">map_array</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>    <span class="c1"># Flip if needed (usually map_array is already in image coords if loaded via cv2, </span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>    <span class="c1"># but if it came from ROS msg it might be bottom-up. </span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>    <span class="c1"># align_est_map_to_gt returns map in GT indices. GT loader uses cv2 no flip?</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>    <span class="c1"># Actually load_gt_map uses cv2.imread which is top-down.</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>    <span class="c1"># But usually ROS maps need flipud to be viewed correctly as image files.</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>    <span class="n">vis_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">vis_map</span><span class="p">)</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>    <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>        <span class="c1"># Add a title bar? slightly complex for cv2 only, let&#39;s keep it raw for now.</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>        <span class="k">pass</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>    <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">output_path</span><span class="p">),</span> <span class="n">vis_map</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "toc.follow", "search.suggest", "search.highlight", "content.code.copy"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
      
    
  </body>
</html>