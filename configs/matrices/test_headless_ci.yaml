
schema_version: 1
name: test_headless_ci
workspace:
  ros_distro: humble
  use_sim_time: true
defaults:
  run:
    warmup_s: 2.0
    drain_s: 1.0
    timeout_s: 30.0  # Short run for CI
    max_restarts: 0
  rosbag:
    enabled: true
    storage_id: sqlite3
    topics: [/tf, /tf_static, /odom, /scan, /map]
  probes:
    required:
    - type: topic_publish
      topic: /scan
      msg_type: sensor_msgs/msg/LaserScan
      min_messages: 1
      timeout_s: 60

datasets:
- id: tb3_sim_explore_modeA
  kind: sim_gazebo
  scenario:
    processes:
    - name: nav2_sim
      cmd:
      - ros2
      - launch
      - /home/schneigu/Projects/benchbot/tools/launch/tb3_sim_no_loc.launch.py
      - use_sim_time:=True
      - x_pose:=0.5
      - y_pose:=0.5
      - world:=/home/schneigu/Projects/benchbot/worlds/fixed_model.world
      - robot_sdf:=/home/schneigu/Projects/benchbot/worlds/waffle_fixed.model
      - params_file:=/home/schneigu/Projects/benchbot/configs/params/nav2_params.yaml
      - use_gazebo:=False  # Headless mode
      - use_rviz:=False    # Headless mode
      env:
        TURTLEBOT3_MODEL: waffle

    - name: kickstart
      cmd: ["/home/schneigu/Projects/benchbot/tools/scripts/kickstart.sh"]
      delay_s: 5.0
      params:
        restart: false

    - name: explore
      delay_s: 10.0
      cmd:
      - /home/schneigu/Projects/benchbot/tools/launch/explore_wrapper.sh
      - ros2
      - run
      - explore_lite
      - explore
      - --ros-args
      - --params-file
      - /home/schneigu/Projects/benchbot/configs/params/explore_params.yaml
      params: {}
  world_model: worlds/model.sdf

slams:
- id: gmapping
  profile: configs/slams/gmapping.yaml

matrix:
  include:
  - dataset: tb3_sim_explore_modeA
    slams:
    - gmapping
    repeats: 1
    seeds: [0]
    tags: [headless_ci]

output:
  root_dir: results/runs_ci
  index_file: results/index_ci.jsonl
  artifacts: {export_map: true}
